package edu.wm.werewolf.constants;

import java.io.BufferedReader;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.util.ArrayList;
import java.util.List;

import org.apache.http.HttpResponse;
import org.apache.http.NameValuePair;
import org.apache.http.client.entity.UrlEncodedFormEntity;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.impl.client.DefaultHttpClient;
import org.apache.http.message.BasicNameValuePair;
import org.json.JSONException;
import org.json.JSONObject;

import android.content.Context;
import android.content.Intent;
import android.os.AsyncTask;
import android.util.Log;
import android.widget.Toast;
import edu.wm.werewolf.GameStatus;

private class DownloadWebPageTask extends AsyncTask<String, Void, String> {
    @Override
    protected String doInBackground(String... urls) {
      String resp = "";
      for (String url : urls) {
        DefaultHttpClient client = new DefaultHttpClient();
        HttpPost httpPost= new HttpPost(url);
		List<NameValuePair> pairs = new ArrayList<NameValuePair>();
		pairs.add(new BasicNameValuePair("userName", usernameText.getText().toString()));
		pairs.add(new BasicNameValuePair("id", usernameText.getText().toString()));
		pairs.add(new BasicNameValuePair("firstName", firstNameText.getText().toString()));
		pairs.add(new BasicNameValuePair("lastName", lastNameText.getText().toString()));
		pairs.add(new BasicNameValuePair("hashedPassword", passwordText.getText().toString()));
        try {
          httpPost.setEntity(new UrlEncodedFormEntity(pairs));
          HttpResponse execute = client.execute(httpPost);
          InputStream content = execute.getEntity().getContent();

          BufferedReader buffer = new BufferedReader(new InputStreamReader(content));
          String s = "";
          while ((s = buffer.readLine()) != null) {
            resp += s;
          }

        } catch (Exception e) {
          e.printStackTrace();
        }
      }
      try {
		response = new JSONObject(resp);
	} catch (JSONException e) {
		// TODO Auto-generated catch block
		e.printStackTrace();
	}
      return resp;
    }

    @Override
    protected void onPostExecute(String result) {
//      Log.v(null, response);
      
      try {
		if(response.getString("status").equals(c.success())){
				Log.v(null, "going to pref");
				Context context3 = getApplicationContext();
				CharSequence text3 = "Successful Registration!";
				int duration3 = Toast.LENGTH_SHORT;
				Toast toast3 = Toast.makeText(context3, text3, duration3);
				toast3.show();
				Intent intent2 = new Intent(context3, GameStatus.class);
				intent2.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);
				startActivity(intent2);
		  }else{
			  	Context context3 = getApplicationContext();
				CharSequence text3 = "There was an error creating your account.";
				int duration3 = Toast.LENGTH_SHORT;
				Toast toast3 = Toast.makeText(context3, text3, duration3);
				toast3.show();
		  }
	} catch (JSONException e) {
		// TODO Auto-generated catch block
		e.printStackTrace();
	}
    }
  }